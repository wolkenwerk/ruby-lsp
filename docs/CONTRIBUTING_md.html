<!DOCTYPE html>

<html>
<head>
<meta charset="UTF-8">

<title>CONTRIBUTING - RDoc Documentation</title>

<script type="text/javascript">
  var rdoc_rel_prefix = "./";
  var index_rel_prefix = "./";
</script>

<script src="./js/navigation.js" defer></script>
<script src="./js/search.js" defer></script>
<script src="./js/search_index.js" defer></script>
<script src="./js/searcher.js" defer></script>
<script src="./js/darkfish.js" defer></script>

<link href="./css/fonts.css" rel="stylesheet">
<link href="./css/rdoc.css" rel="stylesheet">


<body id="top" role="document" class="file">
<nav role="navigation">
  <div id="project-navigation">
    <div id="home-section" role="region" title="Quick navigation" class="nav-section">
  <h2>
    <a href="./index.html" rel="home">Home</a>
  </h2>

  <div id="table-of-contents-navigation">
    <a href="./table_of_contents.html#pages">Pages</a>
    <a href="./table_of_contents.html#classes">Classes</a>
    <a href="./table_of_contents.html#methods">Methods</a>
  </div>
</div>

    <div id="search-section" role="search" class="project-section initially-hidden">
  <form action="#" method="get" accept-charset="utf-8">
    <div id="search-field-wrapper">
      <input id="search-field" role="combobox" aria-label="Search"
             aria-autocomplete="list" aria-controls="search-results"
             type="text" name="search" placeholder="Search" spellcheck="false"
             title="Type to search, Up and Down to navigate, Enter to load">
    </div>

    <ul id="search-results" aria-label="Search Results"
        aria-busy="false" aria-expanded="false"
        aria-atomic="false" class="initially-hidden"></ul>
  </form>
</div>

  </div>

  
<div class="nav-section">
  <h3>Table of Contents</h3>



  <ul class="link-list" role="directory">
              <li>
            <details open>
              <summary>      <a href="#label-CONTRIBUTING">CONTRIBUTING</a>
</summary>
              <ul class="link-list" role="directory">
                          <li>      <a href="#label-Manually+testing+a+change">Manually testing a change</a>
          <li>      <a href="#label-Running+the+test+suite">Running the test suite</a>
          <li>      <a href="#label-Expectation+testing">Expectation testing</a>
          <li>      <a href="#label-Debugging+with+VS+Code">Debugging with VS Code</a>
          <li>      <a href="#label-Debugging+Tests">Debugging Tests</a>
          <li>      <a href="#label-Debugging+Running+Ruby+LSP+Process">Debugging Running Ruby LSP Process</a>
          <li>      <a href="#label-Screen+Captures">Screen Captures</a>
          <li>      <a href="#label-Spell+Checking">Spell Checking</a>

              </ul>
            </details>
          </li>

  </ul>
</div>


  <div id="project-metadata">
    
<div id="fileindex-section" class="nav-section">
  <h3>Pages</h3>

  <ul class="link-list">
    <li><a href="./CODE_OF_CONDUCT_md.html">CODE_OF_CONDUCT</a>
    <li><a href="./CONTRIBUTING_md.html">CONTRIBUTING</a>
    <li><a href="./EDITORS_md.html">EDITORS</a>
    <li><a href="./README_md.html">README</a>
    <li><a href="./SEMANTIC_HIGHLIGHTING_md.html">SEMANTIC_HIGHLIGHTING</a>
    <li><a href="./SERVER_EXTENSIONS_md.html">SERVER_EXTENSIONS</a>
  </ul>
</div>

  </div>
</nav>

<main role="main" aria-label="Page CONTRIBUTING.md">

<h1 id="label-CONTRIBUTING"><a href="CONTRIBUTING_md.html">CONTRIBUTING</a><span><a href="#label-CONTRIBUTING">&para;</a> <a href="#top">&uarr;</a></span></h1>

<h2 id="label-Manually+testing+a+change">Manually testing a change<span><a href="#label-Manually+testing+a+change">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>There are a few options for manually testing changes to Ruby LSP:</p>

<p>You can test against Ruby LSP’s own code if using VS Code, and you have the <code>ruby-lsp</code> project open. Choose ‘Ruby LSP: Restart’ from the command menu and the VS Code extension will detect that you are working on <code>ruby-lsp</code>, and use the locally checked out code instead of the installed extension.</p>

<p>The other way is to use a separate project, and add a Gemfile entry pointing to your local checkout of <code>ruby-lsp</code>, e.g.:</p>

<pre class="ruby"><span class="ruby-identifier">gem</span> <span class="ruby-string">&quot;ruby-lsp&quot;</span>, <span class="ruby-value">path:</span> <span class="ruby-string">&quot;../../Shopify/ruby-lsp&quot;</span>
</pre>

<p>With both approaches, there is a risk of ‘breaking’ your local development experience, so keep an eye on the Ruby LSP output panel for exceptions as your make changes.</p>

<p>You can also refer to the advice about <a href="https://github.com/Shopify/vscode-ruby-lsp#debugging">Debugging and Tracing</a>.</p>

<h2 id="label-Running+the+test+suite">Running the test suite<span><a href="#label-Running+the+test+suite">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>The test suite can be executed by running</p>

<pre># The default runner
bin/test
# or the spec reporter
SPEC_REPORTER=1 bin/test
# Warning are turned off by default. If you wish to see warnings use
VERBOSE=1 bin/test</pre>

<h2 id="label-Expectation+testing">Expectation testing<span><a href="#label-Expectation+testing">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>To simplify the way we run tests over different pieces of Ruby code, we use a custom expectations test framework against a set of Ruby fixtures.</p>

<p>All fixtures are defined under <code>test/fixtures</code>. By default, every request will be executed against every fixture and the test framework will assert that nothing was raised to verify if all requests succeed in processing all fixtures.</p>

<p>Expectations can be added on a per request and per fixture basis. For example, we can have expectations for semantic highlighting for a fixture called <code>foo.rb</code>, but no expectations for the same fixture for any other requests.</p>

<p>We define expectations as <code>.exp</code> files, of which there are two variants: - <code>.exp.rb</code>, to indicate the resulting code after an operation - <code>.exp.json</code>, consisting of a <code>result</code>, and an optional set of input <code>params</code></p>

<p>To add a new test scenario</p>
<ol><li>
<p>Add a new fixture <code>my_fixture.rb</code> file under <code>test/fixtures</code></p>
</li><li>
<p>For applicable requests, add expectation files related to this fixutre. For example, <code>test/expectations/semantic_highlighting/my_fixture.exp.json</code></p>
</li></ol>

<p>To add a new expectations test runner for a new request handler:</p>
<ul><li>
<p>Add a new file under <code>test/requests/MY_REQUEST_expectations_test.rb</code></p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># frozen_string_literal: true</span>

<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;test_helper&quot;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;expectations/expectations_test_runner&quot;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyRequestExpectationsTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ExpectationsTestRunner</span>
  <span class="ruby-comment"># The first argument is the fully qualified name of the request class</span>
  <span class="ruby-comment"># The second argument is the folder name where the expectation files are</span>
  <span class="ruby-identifier">expectations_tests</span> <span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Requests</span><span class="ruby-operator">::</span><span class="ruby-constant">MyRequest</span>, <span class="ruby-string">&quot;my_request&quot;</span>
<span class="ruby-keyword">end</span>
</pre>
<ul><li>
<p>(optional) The default behaviour of running tests is not always enough for every request. You may need to override the base run and assert method to achieve the right behaviour. See <code>diagnostics_expectations_test.rb</code> for an example</p>
</li></ul>

<pre class="ruby"><span class="ruby-comment"># frozen_string_literal: true</span>

<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;test_helper&quot;</span>
<span class="ruby-identifier">require</span> <span class="ruby-string">&quot;expectations/expectations_test_runner&quot;</span>

<span class="ruby-keyword">class</span> <span class="ruby-constant">MyRequestExpectationsTest</span> <span class="ruby-operator">&lt;</span> <span class="ruby-constant">ExpectationsTestRunner</span>
  <span class="ruby-identifier">expectations_tests</span> <span class="ruby-constant">RubyLsp</span><span class="ruby-operator">::</span><span class="ruby-constant">Requests</span><span class="ruby-operator">::</span><span class="ruby-constant">MyRequest</span>, <span class="ruby-string">&quot;my_request&quot;</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">run_expectations</span>(<span class="ruby-identifier">source</span>)
    <span class="ruby-comment"># Run your request for the given source</span>
  <span class="ruby-keyword">end</span>

  <span class="ruby-keyword">def</span> <span class="ruby-identifier ruby-title">assert_expectations</span>(<span class="ruby-identifier">source</span>, <span class="ruby-identifier">expected</span>)
    <span class="ruby-comment"># Invoke run_expectations and then customize how to assert the correct responses</span>
  <span class="ruby-keyword">end</span>
<span class="ruby-keyword">end</span>
</pre>

<h2 id="label-Debugging+with+VS+Code">Debugging with VS Code<span><a href="#label-Debugging+with+VS+Code">&para;</a> <a href="#top">&uarr;</a></span></h2>

<h2 id="label-Debugging+Tests">Debugging Tests<span><a href="#label-Debugging+Tests">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ol><li>
<p>Open the test file</p>
</li><li>
<p>Set breakpoints in the code as desired</p>
</li><li>
<p>Click the debug button on top of test examples</p>
</li></ol>

<h2 id="label-Debugging+Running+Ruby+LSP+Process">Debugging Running Ruby LSP Process<span><a href="#label-Debugging+Running+Ruby+LSP+Process">&para;</a> <a href="#top">&uarr;</a></span></h2>
<ol><li>
<p>Open <a href="https://github.com/Shopify/vscode-ruby-lsp">vscode-ruby-lsp</a> in VS Code</p>
</li><li>
<p>Under <code>Run and Debug</code>, select <code>Run extension</code> and click the start button (or press F5)</p>
</li><li>
<p>The extension host window opened will be running a Ruby LSP process with the debugger attached. To start debugging the live process, go under <code>Run and Debug</code>, select <code>Attach to existing server</code> and click the start button (or press F5)</p>
</li><li>
<p>Add breakpoints and perform the actions necessary for triggering the requests you wish to debug</p>
</li></ol>

<h2 id="label-Screen+Captures">Screen Captures<span><a href="#label-Screen+Captures">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>We include animated screen captures to illustrate Ruby LSP features. For recording new captures, use <a href="https://www.cockos.com/licecap/">LICEcap</a>. For consistency, install the Ruby LSP profile included with this repo. Configure LICEcap to record at 24fps, at 640 x 480. If appropriate, you can adjust the height of the capture, but keep the width at 640.</p>

<h2 id="label-Spell+Checking">Spell Checking<span><a href="#label-Spell+Checking">&para;</a> <a href="#top">&uarr;</a></span></h2>

<p>VS Code users will be prompted to enable the <a href="https://marketplace.visualstudio.com/items?itemName=streetsidesoftware.code-spell-checker">Code Spell Checker</a> extension. By default this will be enabled for all workspaces, but you can choose to selectively enable or disable it per workspace.</p>

<p>If you introduce a word which the spell checker does not recognize, you can add it to the <code>cspell.json</code> configuration alongside your PR.</p>

</main>



<footer id="validator-badges" role="contentinfo">
  <p><a href="https://validator.w3.org/check/referer">Validate</a>
  <p>Generated by <a href="https://ruby.github.io/rdoc/">RDoc</a> 6.5.0.
  <p>Based on <a href="http://deveiate.org/projects/Darkfish-RDoc/">Darkfish</a> by <a href="http://deveiate.org">Michael Granger</a>.
</footer>

